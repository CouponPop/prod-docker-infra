filebeat.inputs:
  # 애플리케이션 로그 수집
  - type: aws-cloudwatch
    log_group_name: /ecs/couponpop-store-service-task-definition
    fields:
      log_type: application
      service: couponpop-store-service
    fields_under_root: true
    # Java 스택 트레이스 멀티라인 처리
    multiline.type: pattern
    multiline.pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'
    multiline.negate: true
    multiline.match: after
    multiline.max_lines: 500
    # 로그 파일 스캔 간격
    scan_frequency: 10s

# Logstash로 전송
output.logstash:
  hosts: [ "localhost:5044" ]
  # 연결 실패 시 재시도
  bulk_max_size: 2048

# 로그 레벨 설정
logging.level: info
logging.to_stderr: true

# 프로세서 설정
processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
  - add_docker_metadata: ~

